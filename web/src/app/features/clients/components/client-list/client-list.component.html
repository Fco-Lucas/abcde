<div class="mat-elevation-z8 rounded-lg overflow-hidden">
  @if(isLoading) {
    <div *ngIf="this.isLoading" class="flex justify-center items-center p-16">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  } @else {
    <div class="overflow-x-auto">
      <table mat-table [dataSource]="dataSource">

        <!-- Coluna Nome -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Nome</th>
          <td mat-cell *matCellDef="let client"> {{client.name}} </td>
        </ng-container>

        <!-- Coluna E-mail -->
        <ng-container matColumnDef="cnpj">
          <th mat-header-cell *matHeaderCellDef>CNPJ</th>
          <td mat-cell *matCellDef="let client"> {{ client.cnpj | mask: '00.000.000/0000-00' }}  </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Situação</th>
          <td mat-cell *matCellDef="let client">{{ client.status === "ACTIVE" ? "ATIVO" : "INATIVO" }}</td>
        </ng-container>

        <!-- Coluna Ações -->
        <ng-container matColumnDef=" ">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let client">
              <button matButton="outlined" [matMenuTriggerFor]="afterMenu">
                Ações
                <mat-icon>keyboard_arrow_down</mat-icon>
              </button>
              <mat-menu #afterMenu="matMenu" xPosition="after">
                <button mat-menu-item [routerLink]="['/app', 'clients', client.id, 'users']" aria-label="Ver usuários do cliente">Usuários</button>
                @if (client.status === "ACTIVE" && client.id !== authenticatedClientId()) {
                  <button mat-menu-item (click)="updateClient.emit(client)" aria-label="Editar cliente">Atualizar</button>
                  <button mat-menu-item (click)="deleteClient.emit(client)" aria-label="Desativar cliente">Desativar</button>
                  <button mat-menu-item (click)="restorePassword.emit(client)" aria-label="Restaurar senha do cliente">Restaurar senha</button>
                }
              </mat-menu>
          </td>
        </ng-container>

        <!-- Definição das linhas do cabeçalho e do corpo -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell text-center p-4" [attr.colspan]="displayedColumns.length">
            Nenhum cliente encontrado
          </td>
        </tr>
      </table>
    </div>

    <!-- Paginador -->
    <mat-paginator 
      (page)="pageChange.emit($event)"
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[5, 10, 20]" 
      showFirstLastButtons
      aria-label="Selecione a página de clientes">
    </mat-paginator>
  }
</div>